language: node_js
node_js:
 - node
dist: trusty
addons:
  chrome: stable
before_script:
 - npm install -g @angular/cli codecov

script:
 - npm run test:ci
 - npm run lint
 - npm run build:all

after_success:
 - codecov

before_deploy:
 - tar -C dist/tf2pickup.pl -zcvf tf2pickup_pl_client-${TRAVIS_TAG}-${TRAVIS_BUILD_NUMBER}.tar.gz .
 - tar -C dist/hl.tf2pickup.pl -xcvf hl_tf2pickup_pl_client-${TRAVIS_TAG}-${TRAVIS_BUILD_NUMBER}.tar.gz .
 - tar -C dist/tf2pickup.es -xcvf tf2pickup_es_client-${TRAVIS_TAG}-${TRAVIS_BUILD_NUMBER}.tar.gz .

deploy:
  provider: releases
  token: $GITHUB_API_KEY
  file:
    - tf2pickup_pl_client-${TRAVIS_TAG}-${TRAVIS_BUILD_NUMBER}.tar.gz
    - hl_tf2pickup_pl_client-${TRAVIS_TAG}-${TRAVIS_BUILD_NUMBER}.tar.gz
    - tf2pickup_es_client-${TRAVIS_TAG}-${TRAVIS_BUILD_NUMBER}.tar.gz
  skip_cleanup: true
  on:
    tags: true

env:
  global:
    secure: nOuFj9A7bxyxs03GjVDq9lLP/ru6GxCItupwxW1EQjma6wffZF8oH2knQQDOwDuMvsehz5H+KL3ZLSbGONIxlk/Ek7bG2KGLjJO37IDyoeL9pdbeLYGYk6fJfvMsxV6vS2onpRP4uQZwupPv0d8MLusFFQSXbLx7XBDRvxncB1UQea1uItWKlwwqQxpJpqpn+FUgT9zcvW7rlxBaoK1TScQNYSkWWd7Z6qyRZS8AJAQ6c+6WLReNiapiLIglcIj1c6O+wiqOfWzq77zaoRvSSL78EAwpolcH6zgTcRbUA1wUdE4Nknum1p6UHLqxppFwc9gtzq+kZCGDtCegKn/lJpEZWSdaEcT1/q7nVaWrF8hwznQVMFx+RpiFUoE16Uq7fwrFLIVT6HOJumCTkb+oVwxk3xwBQrw57lekgB61BIqrh6uSWtwmpOZ6DNIkEcgFIOcUigEK1SfsT6cKcLQpppgniyCWJg+x7VXqMI5RlrfTXGDtdfaRjSlBrxXVRovBUcna2uGUKjt8cdy+KUZ7Rp9J1YvM+UCQDSASCXysToKZ1MwHcdpBwVDlrHY/mZvJLjvjmdCXMJbzMJYl/PtAf0jjf9G1PYaiCCteRupXVfpIpBrHrY/6CE52ktI6w7PYg9ARnIzDhbZaMHbjJi6fiKU2N+nQ0V1l2NCjdm4hAeE=
